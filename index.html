<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="FD Manager Pro - Nepal Edition - Secure Fixed Deposit Management">
    <title>FD Manager Pro - Nepal Edition</title>
<!-- PWA Manifest Link -->
<link rel="manifest" href="manifest.json">

<!-- Theme color for browser UI (matches manifest) -->
<meta name="theme-color" content="#0d6efd">

<!-- Apple Touch Icon (for iOS devices) -->
<link rel="apple-touch-icon" href="images/icon-192x192.png">

<!-- 
    
    <!-- External CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <i class="bi bi-shield-lock-fill"></i>
                <h2>FD Manager Pro</h2>
                <p>Nepal Edition - Secure Fixed Deposit Management</p>
            </div>
            
            <div id="loginForm">
                <div class="mb-3">
                    <label for="loginPin" class="form-label">Enter 4-Digit PIN</label>
                    <input type="password" class="form-control pin-input" id="loginPin" 
                           maxlength="4" pattern="[0-9]{4}" placeholder="****" autocomplete="off">
                </div>
                <button onclick="login()" class="btn btn-primary w-100">
                    <i class="bi bi-unlock-fill"></i> Login
                </button>
                <button onclick="showResetConfirm()" class="btn btn-link w-100 mt-2 text-danger">
                    Reset PIN (Clears All Data)
                </button>
                <hr>
                <button onclick="loadSampleData()" class="btn btn-outline-success w-100">
                    <i class="bi bi-download"></i> Load Sample Data (Demo)
                </button>
            </div>
            
            <div id="setupForm" style="display:none;">
                <div class="mb-3">
                    <label for="setupPin" class="form-label">Create 4-Digit PIN</label>
                    <input type="password" class="form-control pin-input" id="setupPin" 
                           maxlength="4" pattern="[0-9]{4}" placeholder="****">
                </div>
                <div class="mb-3">
                    <label for="confirmPin" class="form-label">Confirm PIN</label>
                    <input type="password" class="form-control pin-input" id="confirmPin" 
                           maxlength="4" pattern="[0-9]{4}" placeholder="****">
                </div>
                <button onclick="setupPin()" class="btn btn-success w-100">
                    <i class="bi bi-check-circle-fill"></i> Create PIN
                </button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" style="display:none;">
        
        <!-- Header -->
        <nav class="navbar navbar-dark bg-primary sticky-top">
            <div class="container-fluid">
                <span class="navbar-brand">
                    <i class="bi bi-cash-coin"></i> FD Manager Pro - Nepal Edition
                </span>
                <div class="d-flex align-items-center">
                    <span class="badge bg-light text-dark me-2" id="currentHolder">All Accounts</span>
                    <button class="btn btn-sm btn-outline-light me-2" onclick="toggleTheme()" title="Toggle Theme">
                        <i class="bi bi-moon-stars-fill"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-light" onclick="logout()" title="Logout">
                        <i class="bi bi-box-arrow-right"></i>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs sticky-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" 
                        data-bs-target="#dashboard" type="button">
                    <i class="bi bi-speedometer2"></i> Dashboard
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="records-tab" data-bs-toggle="tab" 
                        data-bs-target="#records" type="button">
                    <i class="bi bi-journal-text"></i> FD Records
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="quickadd-tab" data-bs-toggle="tab" 
                        data-bs-target="#quickadd" type="button">
                    <i class="bi bi-lightning-charge-fill"></i> Quick Add
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="templates-tab" data-bs-toggle="tab" 
                        data-bs-target="#templates" type="button">
                    <i class="bi bi-bookmark-fill"></i> Templates
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="calculator-tab" data-bs-toggle="tab" 
                        data-bs-target="#calculator" type="button">
                    <i class="bi bi-calculator-fill"></i> Calculator
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="analytics-tab" data-bs-toggle="tab" 
                        data-bs-target="#analytics" type="button">
                    <i class="bi bi-bar-chart-fill"></i> Analytics
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="certificates-tab" data-bs-toggle="tab" 
                        data-bs-target="#certificates" type="button">
                    <i class="bi bi-file-earmark-pdf"></i> Certificates
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="settings-tab" data-bs-toggle="tab" 
                        data-bs-target="#settings" type="button">
                    <i class="bi bi-gear-fill"></i> Settings
                </button>
            </li>
        </ul>

        <!-- Tab Contents -->
        <div class="tab-content p-3" id="mainTabContent">
            
            <!-- Dashboard Tab -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                <div class="container-fluid">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <h4><i class="bi bi-speedometer2"></i> Dashboard</h4>
                        </div>
                        <div class="col-md-6 text-end">
                            <select class="form-select form-select-sm d-inline-block w-auto" 
                                    id="dashboardHolderFilter" onchange="updateDashboard()">
                                <option value="">All Account Holders</option>
                            </select>
                        </div>
                    </div>

                    <!-- Summary Widgets -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <div class="card stat-card stat-card-blue">
                                <div class="card-body">
                                    <h6 class="text-muted mb-2">Total Investment</h6>
                                    <h3 class="mb-0" id="totalInvestment">NRs 0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card stat-card-green">
                                <div class="card-body">
                                    <h6 class="text-muted mb-2">Expected Interest</h6>
                                    <h3 class="mb-0" id="totalInterest">NRs 0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card stat-card-purple">
                                <div class="card-body">
                                    <h6 class="text-muted mb-2">Active FDs</h6>
                                    <h3 class="mb-0" id="activeFDs">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card stat-card-orange">
                                <div class="card-body">
                                    <h6 class="text-muted mb-2">Expiring Soon</h6>
                                    <h3 class="mb-0" id="expiringSoon">0</h3>
                                    <small class="text-muted">Next 30 days</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Maturities -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header bg-warning text-dark">
                                    <i class="bi bi-exclamation-triangle-fill"></i> Upcoming Maturities (Next 30 Days)
                                </div>
                                <div class="card-body">
                                    <div id="upcomingMaturities">
                                        <p class="text-muted">No FDs maturing in the next 30 days</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Portfolio Chart -->
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-pie-chart-fill"></i> Portfolio Distribution
                                </div>
                                <div class="card-body">
                                    <canvas id="portfolioChart" height="100"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">Quick Actions</div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary" onclick="switchTab('records')">
                                            <i class="bi bi-plus-circle"></i> Add New FD
                                        </button>
                                        <button class="btn btn-success" onclick="switchTab('quickadd')">
                                            <i class="bi bi-lightning-charge"></i> Quick Add (OCR)
                                        </button>
                                        <button class="btn btn-info" onclick="switchTab('calculator')">
                                            <i class="bi bi-calculator"></i> Calculate Interest
                                        </button>
                                        <button class="btn btn-secondary" onclick="exportAllPDF()">
                                            <i class="bi bi-file-pdf"></i> Export to PDF
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

           <!-- FD Records Tab - ENHANCED VERSION -->
<div class="tab-pane fade" id="records" role="tabpanel">
    <div class="container-fluid">
        <div class="row mb-3">
            <div class="col-md-6">
                <h4><i class="bi bi-journal-text"></i> FD Records Management</h4>
            </div>
            <div class="col-md-6 text-end">
                <!-- Quick Action Buttons -->
                <div class="btn-group" role="group">
                    <button class="btn btn-sm btn-success" onclick="showQuickAddModal()">
                        <i class="bi bi-lightning-fill"></i> Quick Add
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="duplicateLastFD()">
                        <i class="bi bi-files"></i> Duplicate Last
                    </button>
                    <button class="btn btn-sm btn-info" onclick="showRenewalHelper()">
                        <i class="bi bi-arrow-repeat"></i> Renew FD
                    </button>
                </div>
            </div>
        </div>

        <!-- Enhanced FD Form with Certificate Upload -->
        <div class="card mb-4">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <span id="formTitle">
                        <i class="bi bi-plus-circle"></i> Add New FD
                    </span>
                    <div>
                        <button class="btn btn-sm btn-outline-warning" onclick="loadDraft()" id="loadDraftBtn" style="display:none;">
                            <i class="bi bi-arrow-counterclockwise"></i> Load Draft
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" 
                                id="cancelEditBtn" onclick="cancelEdit()" style="display:none;">
                            <i class="bi bi-x-circle"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <form id="fdForm" onsubmit="saveFD(event)">
                    
                    <!-- Section 1: Basic Information -->
                    <div class="form-section">
                        <h6 class="text-primary mb-3">
                            <i class="bi bi-1-circle-fill"></i> Basic Information
                        </h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Account Holder *</label>
                                <div class="input-group">
                                    <select class="form-select" id="fdAccountHolder" required onchange="loadRecentFDForHolder()">
                                        <option value="">Select Account Holder</option>
                                    </select>
                                    <button class="btn btn-outline-secondary" type="button" onclick="quickAddHolder()" title="Add New Holder">
                                        <i class="bi bi-plus-lg"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Bank Name *</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="fdBank" 
                                           list="bankSuggestions" required autocomplete="off"
                                           onchange="suggestBankRate()" oninput="saveDraft()">
                                    <datalist id="bankSuggestions"></datalist>
                                    <button class="btn btn-outline-info" type="button" onclick="showBankRateHelper()" title="Check Rates">
                                        <i class="bi bi-graph-up"></i>
                                    </button>
                                </div>
                                <small class="text-muted" id="suggestedRate"></small>
                            </div>
                        </div>
                    </div>

                    <!-- Section 2: Amount & Investment Details -->
                    <div class="form-section">
                        <h6 class="text-primary mb-3">
                            <i class="bi bi-2-circle-fill"></i> Investment Details
                        </h6>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Amount (NRs) *</label>
                                <input type="number" class="form-control form-control-lg" id="fdAmount" 
                                       min="1000" step="1000" required 
                                       oninput="updateInterestPreview(); validateAmount(); saveDraft()"
                                       placeholder="e.g., 100000">
                                <small class="text-muted" id="amountInWords"></small>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Interest Rate (% p.a.) *</label>
                                <div class="input-group">
                                    <input type="number" class="form-control form-control-lg" id="fdRate" 
                                           min="0" max="20" step="0.01" required 
                                           oninput="updateInterestPreview(); saveDraft()"
                                           placeholder="e.g., 9.5">
                                    <span class="input-group-text">%</span>
                                </div>
                                <small class="text-success" id="rateComparison"></small>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Start Date *</label>
                                <input type="date" class="form-control" id="fdStartDate" required
                                       onchange="autoCalculateMaturity(); saveDraft()">
                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" id="useTodayDate" onchange="setTodayDate()">
                                    <label class="form-check-label small" for="useTodayDate">
                                        Use today's date
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Duration *</label>
                                <input type="number" class="form-control" id="fdDuration" 
                                       min="1" step="1" required 
                                       oninput="updateInterestPreview(); autoCalculateMaturity(); saveDraft()"
                                       placeholder="e.g., 12">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Duration Unit *</label>
                                <select class="form-select" id="fdDurationUnit" 
                                        onchange="toggleCustomMaturity(); autoCalculateMaturity(); saveDraft()" required>
                                    <option value="Months">Months</option>
                                    <option value="Years">Years</option>
                                    <option value="Days">Days</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Maturity Date</label>
                                <input type="date" class="form-control" id="fdMaturityDate" readonly
                                       style="background-color: #f0f0f0;">
                                <small class="text-muted">Auto-calculated</small>
                            </div>
                        </div>

                        <!-- Quick Duration Presets -->
                        <div class="mb-3">
                            <label class="form-label small text-muted">Quick Duration:</label>
                            <div class="btn-group btn-group-sm" role="group">
                                <button type="button" class="btn btn-outline-secondary" onclick="setDuration(3, 'Months')">3M</button>
                                <button type="button" class="btn btn-outline-secondary" onclick="setDuration(6, 'Months')">6M</button>
                                <button type="button" class="btn btn-outline-secondary" onclick="setDuration(12, 'Months')">1Y</button>
                                <button type="button" class="btn btn-outline-secondary" onclick="setDuration(18, 'Months')">18M</button>
                                <button type="button" class="btn btn-outline-secondary" onclick="setDuration(24, 'Months')">2Y</button>
                                <button type="button" class="btn btn-outline-secondary" onclick="setDuration(36, 'Months')">3Y</button>
                                <button type="button" class="btn btn-outline-secondary" onclick="setDuration(60, 'Months')">5Y</button>
                            </div>
                        </div>
                    </div>

                    <!-- Section 3: Certificate & Additional Info -->
                    <div class="form-section">
                        <h6 class="text-primary mb-3">
                            <i class="bi bi-3-circle-fill"></i> Certificate & Additional Information
                        </h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Certificate Status</label>
                                <select class="form-select" id="fdCertStatus" onchange="toggleCertificateUpload(); saveDraft()">
                                    <option value="Not Obtained">Not Obtained</option>
                                    <option value="Obtained">Obtained - Ready to Upload</option>
                                    <option value="Digital">Digital Certificate</option>
                                    <option value="Physical">Physical Certificate Only</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">FD Number / Certificate Number</label>
                                <input type="text" class="form-control" id="fdNumber" 
                                       placeholder="e.g., FD/2024/001234"
                                       oninput="saveDraft()">
                            </div>
                        </div>

                        <!-- Certificate Upload Section -->
                        <div id="certificateUploadSection" style="display:none;">
                            <div class="card border-primary mb-3">
                                <div class="card-header bg-primary text-white">
                                    <i class="bi bi-cloud-upload"></i> Upload FD Certificate
                                </div>
                                <div class="card-body">
                                    <div class="upload-area" id="certUploadArea">
                                        <input type="file" class="form-control" id="fdCertificate" 
                                               accept=".pdf,.jpg,.jpeg,.png"
                                               onchange="previewCertificate(this)">
                                        <div class="text-center mt-2">
                                            <i class="bi bi-file-earmark-arrow-up" style="font-size: 2rem; color: #0d6efd;"></i>
                                            <p class="mb-0">Click to upload or drag & drop</p>
                                            <small class="text-muted">Supports: JPG, PNG, PDF (Max 5MB)</small>
                                        </div>
                                    </div>
                                    
                                    <!-- Certificate Preview -->
                                    <div id="certificatePreview" style="display:none;" class="mt-3">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <strong>Preview:</strong>
                                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeCertificatePreview()">
                                                <i class="bi bi-trash"></i> Remove
                                            </button>
                                        </div>
                                        <div class="border rounded p-2 text-center" style="background-color: #f8f9fa;">
                                            <img id="certPreviewImage" style="max-width: 100%; max-height: 300px; display:none;" alt="Certificate Preview">
                                            <div id="certPreviewPDF" style="display:none;">
                                                <i class="bi bi-file-pdf" style="font-size: 5rem; color: #dc3545;"></i>
                                                <p class="mb-0"><strong id="certFileName"></strong></p>
                                                <small class="text-muted" id="certFileSize"></small>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Quick OCR Option -->
                                    <div class="alert alert-info mt-3 mb-0">
                                        <i class="bi bi-lightbulb"></i> <strong>Tip:</strong> 
                                        Want to auto-fill details from certificate? Use 
                                        <a href="#" onclick="switchTab('quickadd'); return false;" class="alert-link">Quick Add (OCR)</a> instead!
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Notes / Tags</label>
                            <textarea class="form-control" id="fdNotes" rows="2" 
                                      placeholder="e.g., For child education, Tax saving, Emergency fund..."
                                      oninput="saveDraft()"></textarea>
                            <div class="mt-2">
                                <small class="text-muted">Quick Tags:</small>
                                <div class="btn-group btn-group-sm ms-2" role="group">
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addTag('Emergency Fund')">Emergency Fund</button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addTag('Child Education')">Child Education</button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addTag('Retirement')">Retirement</button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addTag('Tax Saving')">Tax Saving</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Interest Preview (Enhanced) -->
                    <div class="card border-info mb-3">
                        <div class="card-header bg-info bg-opacity-10">
                            <strong><i class="bi bi-calculator"></i> Expected Returns Preview</strong>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="p-2">
                                        <small class="text-muted">Quarterly</small>
                                        <h5 class="mb-0 text-primary" id="previewQuarterly">NRs 0</h5>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="p-2">
                                        <small class="text-muted">Monthly</small>
                                        <h5 class="mb-0 text-success" id="previewMonthly">NRs 0</h5>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="p-2">
                                        <small class="text-muted">Annual</small>
                                        <h5 class="mb-0 text-warning" id="previewAnnual">NRs 0</h5>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="p-2 bg-light rounded">
                                        <small class="text-muted">Maturity Amount</small>
                                        <h4 class="mb-0 text-danger" id="previewMaturity">NRs 0</h4>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-md-6">
                                    <small><strong>TDS (5%):</strong> <span id="tdsTax">NRs 0</span></small>
                                </div>
                                <div class="col-md-6 text-end">
                                    <small><strong>Net Interest:</strong> <span id="netInterest" class="text-success">NRs 0</span></small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Smart Suggestions -->
                    <div id="smartSuggestions" class="alert alert-warning" style="display:none;">
                        <strong><i class="bi bi-stars"></i> Smart Suggestion:</strong>
                        <span id="suggestionText"></span>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex gap-2 flex-wrap">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-save"></i> Save FD Record
                        </button>
                        <button type="button" class="btn btn-success" onclick="saveAndAddAnother()">
                            <i class="bi bi-plus-circle"></i> Save & Add Another
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="saveDraft()">
                            <i class="bi bi-cloud"></i> Save Draft
                        </button>
                        <button type="button" class="btn btn-outline-danger" onclick="clearForm()">
                            <i class="bi bi-x-circle"></i> Clear Form
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Records Table (Keep existing table code) -->
        <div class="card">
            <div class="card-header">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        <span>All FD Records</span>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control form-control-sm" 
                               id="searchRecords" placeholder="ðŸ” Search..." 
                               oninput="filterRecords()">
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="btn-group btn-group-sm" role="group">
                            <button class="btn btn-outline-secondary active" 
                                    onclick="setRecordFilter('all')">All</button>
                            <button class="btn btn-outline-success" 
                                    onclick="setRecordFilter('active')">Active</button>
                            <button class="btn btn-outline-warning" 
                                    onclick="setRecordFilter('expiring')">Expiring</button>
                            <button class="btn btn-outline-danger" 
                                    onclick="setRecordFilter('matured')">Matured</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body table-responsive">
                <div class="mb-2">
                    <button class="btn btn-sm btn-danger" onclick="deleteSelected()" id="deleteSelectedBtn" disabled>
                        <i class="bi bi-trash"></i> Delete Selected
                    </button>
                    <button class="btn btn-sm btn-success" onclick="exportToExcel()">
                        <i class="bi bi-file-excel"></i> Export to Excel
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="exportAllPDF()">
                        <i class="bi bi-file-pdf"></i> Export to PDF
                    </button>
                    <button class="btn btn-sm btn-info" onclick="importCSV()">
                        <i class="bi bi-upload"></i> Import CSV
                    </button>
                </div>
                <table class="table table-hover table-striped" id="recordsTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                            <th onclick="sortTable('holder')">Holder <i class="bi bi-arrow-down-up"></i></th>
                            <th onclick="sortTable('bank')">Bank <i class="bi bi-arrow-down-up"></i></th>
                            <th onclick="sortTable('amount')">Amount <i class="bi bi-arrow-down-up"></i></th>
                            <th>Duration</th>
                            <th onclick="sortTable('rate')">Rate % <i class="bi bi-arrow-down-up"></i></th>
                            <th onclick="sortTable('startDate')">Start Date <i class="bi bi-arrow-down-up"></i></th>
                            <th>Maturity Date</th>
                            <th onclick="sortTable('daysRemaining')">Days Left <i class="bi bi-arrow-down-up"></i></th>
                            <th>Interest</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="recordsTableBody">
                        <tr>
                            <td colspan="12" class="text-center text-muted">No records found</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Quick Add Modal -->
<div class="modal fade" id="quickAddModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title"><i class="bi bi-lightning-fill"></i> Quick Add FD</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted">Fill only essential fields. Other details can be added later.</p>
                <form id="quickAddForm" onsubmit="saveQuickFD(event)">
                    <div class="mb-3">
                        <label class="form-label">Account Holder *</label>
                        <select class="form-select" id="quickHolder" required>
                            <option value="">Select Holder</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Bank *</label>
                        <input type="text" class="form-control" id="quickBank" list="bankSuggestions" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Amount (NRs) *</label>
                        <input type="number" class="form-control" id="quickAmount" required min="1000">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Rate (%) *</label>
                        <input type="number" class="form-control" id="quickRate" required step="0.01">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Duration *</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="quickDuration" required>
                            <select class="form-select" id="quickUnit" style="max-width: 120px;">
                                <option value="Months">Months</option>
                                <option value="Years">Years</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success w-100">
                        <i class="bi bi-check-circle"></i> Quick Save
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Renewal Helper Modal -->
<div class="modal fade" id="renewalModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title"><i class="bi bi-arrow-repeat"></i> FD Renewal Helper</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Select FD to Renew</label>
                    <select class="form-select" id="renewalFDSelect" onchange="loadRenewalDetails()">
                        <option value="">Choose FD...</option>
                    </select>
                </div>
                <div id="renewalDetails" style="display:none;">
                    <div class="alert alert-info">
                        <strong>Original FD:</strong><br>
                        <span id="renewalOriginalDetails"></span>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">New Start Date</label>
                        <input type="date" class="form-control" id="renewalStartDate">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">New Rate (%)</label>
                        <input type="number" class="form-control" id="renewalRate" step="0.01">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Reinvest Interest?</label>
                        <select class="form-select" id="renewalReinvest">
                            <option value="no">No - Same Amount</option>
                            <option value="yes">Yes - Amount + Interest</option>
                        </select>
                    </div>
                    <button class="btn btn-info w-100" onclick="processRenewal()">
                        <i class="bi bi-check-circle"></i> Create Renewal FD
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
            <!-- Quick Add (OCR) Tab -->
            <div class="tab-pane fade" id="quickadd" role="tabpanel">
                <div class="container-fluid">
                    <h4 class="mb-3"><i class="bi bi-lightning-charge-fill"></i> Quick Add with OCR</h4>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Select Account Holder *</label>
                                    <select class="form-select" id="ocrAccountHolder">
                                        <option value="">Select Account Holder</option>
                                    </select>
                                </div>
                            </div>

                            <div class="upload-zone" id="uploadZone" onclick="document.getElementById('ocrFile').click()">
                                <i class="bi bi-cloud-upload" style="font-size: 3rem;"></i>
                                <h5>Click to Upload FD Certificate</h5>
                                <p class="text-muted">Supports JPG, PNG, PDF (Max 5MB)</p>
                                <input type="file" id="ocrFile" accept=".pdf,.jpg,.jpeg,.png" 
                                       onchange="processOCR()" style="display:none;">
                                <button class="btn btn-primary" type="button">
                                    Choose File
                                </button>
                            </div>

                            <div id="ocrProgress" style="display:none;" class="mt-3">
                                <div class="progress">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                         role="progressbar" style="width: 100%">
                                        Processing OCR... Please wait
                                    </div>
                                </div>
                            </div>

                            <div id="ocrResults" style="display:none;" class="mt-4">
                                <h5>Extracted Data:</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <table class="table table-bordered">
                                            <tr><th>Bank:</th><td id="ocrBank">-</td></tr>
                                            <tr><th>Amount:</th><td id="ocrAmount">-</td></tr>
                                            <tr><th>Rate:</th><td id="ocrRate">-</td></tr>
                                            <tr><th>Start Date:</th><td id="ocrStartDate">-</td></tr>
                                            <tr><th>Maturity Date:</th><td id="ocrMaturityDate">-</td></tr>
                                            <tr><th>Duration:</th><td id="ocrDuration">-</td></tr>
                                        </table>
                                    </div>
                                    <div class="col-md-6">
                                        <img id="ocrPreview" style="max-width:100%; max-height:300px; border: 1px solid #ddd;" alt="Certificate Preview">
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-success" onclick="confirmOCRData()">
                                        <i class="bi bi-check-circle"></i> Confirm & Save
                                    </button>
                                    <button class="btn btn-primary" onclick="editOCRData()">
                                        <i class="bi bi-pencil"></i> Edit Before Saving
                                    </button>
                                    <button class="btn btn-secondary" onclick="cancelOCR()">
                                        <i class="bi bi-x-circle"></i> Cancel
                                    </button>
                                </div>
                            </div>

                            <div class="alert alert-info mt-3">
    <strong><i class="bi bi-info-circle"></i> OCR Tips:</strong>
    <ul class="mb-0 mt-2 small">
        <li><strong>Supported formats:</strong> JPG, JPEG, PNG only (PDF not supported)</li>
        <li>Use clear, well-lit photos</li>
        <li>Ensure entire certificate is visible</li>
        <li>Hold camera straight (not tilted)</li>
        <li>Avoid shadows and glare</li>
        <li>High resolution works best (under 5MB)</li>
    </ul>
</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Templates Tab -->
            <div class="tab-pane fade" id="templates" role="tabpanel">
                <div class="container-fluid">
                    <h4 class="mb-3"><i class="bi bi-bookmark-fill"></i> FD Templates</h4>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">Create New Template</div>
                                <div class="card-body">
                                    <form onsubmit="saveTemplate(event)">
                                        <div class="mb-3">
                                            <label class="form-label">Template Name *</label>
                                            <input type="text" class="form-control" id="templateName" 
                                                   placeholder="e.g., Nabil 1-Year Regular" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Bank Name *</label>
                                            <input type="text" class="form-control" id="templateBank" required>
                                        </div>
                                        <div class="row">
                                            <div class="col-6 mb-3">
                                                <label class="form-label">Duration *</label>
                                                <input type="number" class="form-control" id="templateDuration" 
                                                       min="1" required>
                                            </div>
                                            <div class="col-6 mb-3">
                                                <label class="form-label">Unit *</label>
                                                <select class="form-select" id="templateUnit" required>
                                                    <option value="Months">Months</option>
                                                    <option value="Years">Years</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Interest Rate (%) *</label>
                                            <input type="number" class="form-control" id="templateRate" 
                                                   step="0.01" required>
                                        </div>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-save"></i> Save Template
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Saved Templates</div>
                                <div class="card-body" id="templatesList">
                                    <p class="text-muted">No templates saved yet</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

           <!-- Calculator Tab - COMPLETE REPLACEMENT -->
<div class="tab-pane fade" id="calculator" role="tabpanel">
    <div class="container-fluid">
        <h4 class="mb-3"><i class="bi bi-calculator-fill"></i> Interest Calculator</h4>

        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Calculate Interest</div>
                    <div class="card-body">
                        <!-- Calculation Mode -->
                        <div class="mb-3">
                            <label class="form-label"><strong>Calculation Mode</strong></label>
                            <select class="form-select" id="calcMode" onchange="toggleCalcMode()">
                                <option value="manual">Custom Input (Manual)</option>
                                <option value="existing">From Existing FD</option>
                            </select>
                        </div>

                        <!-- Existing FD Selection (Hidden by default) -->
                        <div id="existingFDSection" style="display:none;">
                            <div class="mb-3">
                                <label class="form-label">Select Account Holder</label>
                                <select class="form-select" id="calcAccountHolder" onchange="loadFDsForCalc()">
                                    <option value="">Select Holder</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Select FD</label>
                                <select class="form-select" id="calcFDSelect" onchange="fillCalcFromFD()">
                                    <option value="">Select FD</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="calcCustomDateRange" onchange="toggleCalcDateRange()">
                                    <label class="form-check-label" for="calcCustomDateRange">
                                        Calculate for Custom Date Range
                                    </label>
                                </div>
                            </div>
                            <div id="calcDateRangeDiv" style="display:none;">
                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <label class="form-label">From Date</label>
                                        <input type="date" class="form-control" id="calcFromDate">
                                    </div>
                                    <div class="col-6 mb-3">
                                        <label class="form-label">To Date</label>
                                        <input type="date" class="form-control" id="calcToDate">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Manual Input Section -->
                        <div id="manualInputSection">
                            <div class="mb-3">
                                <label class="form-label">Principal Amount (NRs)</label>
                                <input type="number" class="form-control" id="calcPrincipal" 
                                       min="1" value="100000" step="1000">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Interest Rate (% p.a.)</label>
                                <input type="number" class="form-control" id="calcRate" 
                                       step="0.01" value="9.5" min="0" max="20">
                            </div>
                            <div class="row">
                                <div class="col-6 mb-3">
                                    <label class="form-label">Duration</label>
                                    <input type="number" class="form-control" id="calcDuration" 
                                           min="1" value="12">
                                </div>
                                <div class="col-6 mb-3">
                                    <label class="form-label">Unit</label>
                                    <select class="form-select" id="calcUnit">
                                        <option value="Months" selected>Months</option>
                                        <option value="Years">Years</option>
                                        <option value="Days">Days</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Common Fields -->
                        <div class="mb-3">
                            <label class="form-label">Compounding Frequency</label>
                            <select class="form-select" id="calcFrequency">
                                <option value="4" selected>Quarterly (4 times/year)</option>
                                <option value="12">Monthly (12 times/year)</option>
                                <option value="1">Annually (1 time/year)</option>
                                <option value="365">Daily (365 times/year)</option>
                                <option value="0">At Maturity (Simple)</option>
                            </select>
                        </div>

                        <button type="button" class="btn btn-primary w-100" onclick="performCalculation()">
                            <i class="bi bi-calculator"></i> Calculate Interest
                        </button>
                    </div>
                </div>

                <!-- Quick Presets -->
                <div class="card mt-3">
                    <div class="card-header">Quick Presets (Nepal Banks)</div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-sm btn-outline-primary" onclick="setCalcPreset(100000, 9.25, 12, 'Months')">
                                Nabil Bank - 1 Year @ 9.25%
                            </button>
                            <button class="btn btn-sm btn-outline-primary" onclick="setCalcPreset(250000, 10.0, 24, 'Months')">
                                Global IME - 2 Years @ 10%
                            </button>
                            <button class="btn btn-sm btn-outline-primary" onclick="setCalcPreset(500000, 10.5, 36, 'Months')">
                                NIC Asia - 3 Years @ 10.5%
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-graph-up"></i> Calculation Results
                    </div>
                    <div class="card-body">
                        <div id="calcResults" style="display:none;">
                            <div class="alert alert-info">
                                <h6 class="mb-3"><strong>Investment Summary</strong></h6>
                                <table class="table table-sm table-borderless mb-0">
                                    <tr>
                                        <td><strong>Principal Amount:</strong></td>
                                        <td class="text-end" id="resultPrincipal">-</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Interest Rate:</strong></td>
                                        <td class="text-end" id="resultRate">-</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Duration:</strong></td>
                                        <td class="text-end" id="resultDuration">-</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Compounding:</strong></td>
                                        <td class="text-end" id="resultFrequency">-</td>
                                    </tr>
                                </table>
                            </div>

                            <table class="table table-bordered">
                                <tr class="table-info">
                                    <th>Simple Interest:</th>
                                    <td class="text-end"><strong id="resultSimple">-</strong></td>
                                </tr>
                                <tr class="table-success">
                                    <th>Compound Interest:</th>
                                    <td class="text-end"><strong id="resultCompound">-</strong></td>
                                </tr>
                                <tr class="table-warning">
                                    <th>Total Maturity Amount:</th>
                                    <td class="text-end"><h5 class="mb-0"><strong id="resultMaturity">-</strong></h5></td>
                                </tr>
                                <tr class="table-light">
                                    <th>Difference (Compound - Simple):</th>
                                    <td class="text-end"><span id="resultDifference" class="text-success">-</span></td>
                                </tr>
                            </table>

                            <div class="alert alert-secondary small">
                                <strong>Note:</strong> Actual returns may vary based on bank policies, 
                                early withdrawal penalties, and tax deductions (TDS @ 5-15%).
                            </div>

                            <div class="btn-group w-100" role="group">
                                <button class="btn btn-sm btn-outline-primary" onclick="printCalculation()">
                                    <i class="bi bi-printer"></i> Print
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="saveCalculationToHistory()">
                                    <i class="bi bi-save"></i> Save
                                </button>
                            </div>
                        </div>
                        <div id="noCalcResults">
                            <div class="text-center text-muted py-5">
                                <i class="bi bi-info-circle" style="font-size: 3rem;"></i>
                                <p class="mt-3">Select calculation mode and click <strong>Calculate Interest</strong></p>
                                <ul class="text-start small">
                                    <li><strong>Custom Input:</strong> Enter your own values</li>
                                    <li><strong>From Existing FD:</strong> Auto-fill from saved FDs</li>
                                    <li><strong>Custom Date Range:</strong> Calculate partial interest</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interest Comparison Chart -->
                <div class="card mt-3" id="comparisonCard" style="display:none;">
                    <div class="card-header">
                        <i class="bi bi-bar-chart"></i> Interest Comparison
                    </div>
                    <div class="card-body">
                        <canvas id="interestComparisonChart" height="200"></canvas>
                    </div>
                </div>

                <!-- Calculation History -->
                <div class="card mt-3">
                    <div class="card-header">
                        Recent Calculations
                        <button class="btn btn-sm btn-outline-danger float-end" onclick="clearCalculationHistory()">
                            Clear All
                        </button>
                    </div>
                    <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                        <div id="calculationHistory">
                            <p class="text-muted small">No saved calculations</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

            <!-- Analytics Tab -->
            <div class="tab-pane fade" id="analytics" role="tabpanel">
                <div class="container-fluid">
                    <h4 class="mb-3"><i class="bi bi-bar-chart-fill"></i> Portfolio Analytics</h4>

                    <div class="row mb-3">
                        <div class="col-md-12">
                            <div class="btn-group" role="group">
                                <button class="btn btn-outline-primary active" onclick="changeChartType('pie')">
                                    Pie Chart
                                </button>
                                <button class="btn btn-outline-primary" onclick="changeChartType('bar')">
                                    Bar Chart
                                </button>
                                <button class="btn btn-outline-primary" onclick="changeChartType('doughnut')">
                                    Doughnut Chart
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">Investment Distribution by Bank</div>
                                <div class="card-body">
                                    <canvas id="analyticsChart" height="100"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">Summary</div>
                                <div class="card-body">
                                    <table class="table table-sm">
                                        <tr>
                                            <th>Total Banks:</th>
                                            <td id="analyticsTotalBanks">0</td>
                                        </tr>
                                        <tr>
                                            <th>Total FDs:</th>
                                            <td id="analyticsTotalFDs">0</td>
                                        </tr>
                                        <tr>
                                            <th>Total Investment:</th>
                                            <td id="analyticsTotalInvestment">NRs 0</td>
                                        </tr>
                                        <tr>
                                            <th>Total Interest:</th>
                                            <td id="analyticsTotalInterest">NRs 0</td>
                                        </tr>
                                        <tr>
                                            <th>Avg. Rate:</th>
                                            <td id="analyticsAvgRate">0%</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">Bank-wise Performance Analysis</div>
                                <div class="card-body table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Bank</th>
                                                <th>No. of FDs</th>
                                                <th>Total Investment</th>
                                                <th>Total Interest</th>
                                                <th>Avg. Rate</th>
                                            </tr>
                                        </thead>
                                        <tbody id="bankAnalysisTable">
                                            <tr>
                                                <td colspan="5" class="text-center text-muted">No data available</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Certificates Tab -->
            <div class="tab-pane fade" id="certificates" role="tabpanel">
                <div class="container-fluid">
                    <h4 class="mb-3"><i class="bi bi-file-earmark-pdf"></i> Certificate Gallery</h4>
                    
                    <div class="row" id="certificatesGallery">
                        <div class="col-12 text-center text-muted">
                            <p>No certificates uploaded yet</p>
                        </div>
                    </div>
                </div>
            </div>

 <!-- Settings Tab -->
<div class="tab-pane fade" id="settings" role="tabpanel">
    <div class="container-fluid">
        <h4 class="mb-3"><i class="bi bi-gear-fill"></i> Settings</h4>

        <div class="row">
            <div class="col-md-6">
                <!-- Account Holder Management -->
                <div class="card mb-3">
                    <div class="card-header bg-primary text-white">
                        <i class="bi bi-people-fill"></i> Account Holder Management
                    </div>
                    <div class="card-body">
                        <form onsubmit="addAccountHolder(event)">
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="newAccountHolder" 
                                       placeholder="Enter name" required>
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-plus-circle"></i> Add
                                </button>
                            </div>
                        </form>
                        <div id="accountHoldersList"></div>
                    </div>
                </div>

                <!-- Enhanced CSV Import/Export -->
                <div class="card mb-3">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-file-earmark-spreadsheet"></i> CSV Import/Export
                    </div>
                    <div class="card-body">
                        <!-- CSV Import Section -->
                        <h6 class="mb-3">
                            <i class="bi bi-upload"></i> Import from CSV
                        </h6>
                        <div class="mb-3">
                            <label for="bulkCSVImportFile" class="form-label small text-muted">
                                Select CSV File
                            </label>
                            <input type="file" 
                                   id="bulkCSVImportFile" 
                                   accept=".csv" 
                                   class="form-control form-control-sm">
                            <div class="form-text">
                                Format: accountHolder, bank, amount, duration, unit, rate, startDate, maturityDate, certificateStatus, notes
                            </div>
                        </div>
                        <button class="btn btn-primary w-100 mb-2" 
                                onclick="handleBulkCSVImportSmart()">
                            <i class="bi bi-file-earmark-arrow-up"></i> Smart Import CSV
                        </button>
                        <div class="alert alert-success alert-sm mb-3">
                            <i class="bi bi-shield-check"></i> <small><strong>Smart Import Features:</strong></small>
                            <ul class="mb-0 mt-1 small">
                                <li>Automatically detects duplicate records</li>
                                <li>Shows preview before importing</li>
                                <li>Choose to add new only or update existing</li>
                            </ul>
                        </div>

                        <hr>

                        <!-- CSV Export Section -->
                        <h6 class="mb-3">
                            <i class="bi bi-download"></i> Export to CSV
                        </h6>
                        <button class="btn btn-success w-100" onclick="exportAllToCSV()">
                            <i class="bi bi-download"></i> Export All Records to CSV
                        </button>
                        <small class="text-muted d-block mt-2">
                            <i class="bi bi-info-circle"></i> Downloads all FD records in CSV format
                        </small>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="card mb-3">
                    <div class="card-header bg-warning text-dark">
                        <i class="bi bi-shield-lock-fill"></i> Security
                    </div>
                    <div class="card-body">
                        <button class="btn btn-warning w-100 mb-2" onclick="showChangePIN()">
                            <i class="bi bi-key-fill"></i> Change PIN
                        </button>
                        <button class="btn btn-danger w-100" onclick="showResetConfirm()">
                            <i class="bi bi-exclamation-triangle-fill"></i> Reset PIN (Clears All Data)
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <!-- Enhanced Backup & Restore -->
                <div class="card mb-3">
                    <div class="card-header bg-info text-white">
                        <i class="bi bi-cloud-arrow-down-fill"></i> Backup & Restore
                    </div>
                    <div class="card-body">
                        <!-- Backup Section -->
                        <h6 class="mb-3">
                            <i class="bi bi-cloud-arrow-down"></i> Create Backup
                        </h6>
                        <p class="text-muted small">
                            Complete backup including all FDs, account holders, templates, and settings.
                        </p>
                        <button class="btn btn-success w-100 mb-3" onclick="backupData()">
                            <i class="bi bi-download"></i> Download Full Backup (JSON)
                        </button>

                        <hr>

                        <!-- Restore Section -->
                        <h6 class="mb-3">
                            <i class="bi bi-cloud-arrow-up"></i> Restore from Backup
                        </h6>
                        <div class="mb-3">
                            <label for="restoreFile" class="form-label small text-muted">
                                Select Backup File
                            </label>
                            <input type="file" 
                                   id="restoreFile" 
                                   accept=".json" 
                                   class="form-control form-control-sm">
                        </div>
                        <button class="btn btn-warning w-100 mb-2" 
                                onclick="restoreDataSmart()">
                            <i class="bi bi-arrow-counterclockwise"></i> Smart Restore Backup
                        </button>
                        <div class="alert alert-info alert-sm mb-3">
                            <i class="bi bi-shield-check"></i> <small><strong>Smart Restore Features:</strong></small>
                            <ul class="mb-0 mt-1 small">
                                <li>Preview data before restoring</li>
                                <li>Detects duplicate records automatically</li>
                                <li>Choose to merge or replace existing data</li>
                            </ul>
                        </div>

                        <hr>

                        <!-- Clear All Data -->
                        <div class="alert alert-danger mb-0">
                            <h6 class="alert-heading">
                                <i class="bi bi-exclamation-triangle-fill"></i> Danger Zone
                            </h6>
                            <p class="small mb-2">
                                This will permanently delete all FD records, account holders, and templates. This action cannot be undone!
                            </p>
                            <button class="btn btn-danger btn-sm w-100" onclick="clearAllData()">
                                <i class="bi bi-trash"></i> Clear All Data
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Display Settings -->
                <div class="card mb-3">
                    <div class="card-header bg-secondary text-white">
                        <i class="bi bi-palette-fill"></i> Display Settings
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Currency Symbol</label>
                            <select class="form-select" id="currencySymbol" onchange="saveSettings()">
                                <option value="NRs" selected>NRs (Nepali Rupees)</option>
                                <option value="Rs">Rs (Rupees)</option>
                                <option value="â‚¹">â‚¹ (Indian Rupee)</option>
                                <option value="$">$ (US Dollar)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" 
                                       id="darkMode" onchange="toggleTheme()">
                                <label class="form-check-label" for="darkMode">
                                    Dark Mode
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- About -->
                <div class="card">
                    <div class="card-header bg-dark text-white">
                        <i class="bi bi-info-circle-fill"></i> About
                    </div>
                    <div class="card-body">
                        <h6 class="mb-2">FD Manager Pro - Nepal Edition v4.0</h6>
                        <p class="text-muted small mb-3">
                            Complete Fixed Deposit Management System with Smart Import, OCR, Analytics & Automation
                        </p>
                        <table class="table table-sm table-borderless small">
                            <tr>
                                <td><strong>Supported Banks:</strong></td>
                                <td>27+ Nepal Banks</td>
                            </tr>
                            <tr>
                                <td><strong>Default Currency:</strong></td>
                                <td>Nepali Rupees (NRs)</td>
                            </tr>
                            <tr>
                                <td><strong>Features:</strong></td>
                                <td>Smart Import, OCR, Analytics, Backup</td>
                            </tr>
                            <tr>
                                <td><strong>Storage:</strong></td>
                                <td>Local Browser Storage</td>
                            </tr>
                        </table>
                        <div class="alert alert-info alert-sm mb-0">
                            <small>
                                <i class="bi bi-shield-lock"></i> All data is stored locally in your browser. 
                                No data is sent to external servers.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- CSV Import Hidden Input -->
    <input type="file" id="csvFileInput" accept=".csv" style="display:none;" onchange="handleCSVImport()">

    <!-- External JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>

    <!-- Custom JavaScript (Order matters!) -->
    <script src="js/utils.js"></script>
    <script src="js/ocr-enhanced.js"></script>
    <script src="js/app.js"></script>
    <script src="js/app-part2.js"></script>
    <script src="js/app-part3.js"></script>

</body>
</html>